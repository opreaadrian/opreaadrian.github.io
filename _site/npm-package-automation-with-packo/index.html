<!DOCTYPE html><html lang="en" itemscope itemtype="https://schema.org/Blog"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Npm package automation with packo</title><meta name="keywords" content="nodejs, workflow, automation, npm, packages, cli"><meta name="author" itemprop="creator" content="Adrian Oprea"><meta name="description" itemprop="description" content="Developing NodeJS applications for the past year meant that I often found myself in front of monolythic applications, that clunked all-things-functionality in 3 or 4 so-called libraries. I’m not a huge fan of compiled languages, and after college I was really reluctant towards languages like Java, but one thing I really learned to appreciate is the modularity that you can reach with it, especially with statements like import package.*;. "><meta property="og:type" content="article" /><meta property="og:title" content="Npm package automation with packo" /><meta property="og:description" content="Developing NodeJS applications for the past year meant that I often found myself in front of monolythic applications, that clunked all-things-functionality in 3 or 4 so-called libraries. I’m not a huge fan of compiled languages, and after college I was really reluctant towards languages like Java, but one thing I really learned to appreciate is the modularity that you can reach with it, especially with statements like import package.*;. " /><meta property="og:image" content="https://codesi.nz/images/posts/automation.jpg" /><meta property="og:url" content="https://codesi.nz/npm-package-automation-with-packo/" /><meta property="og:locale" content="en_US" /><meta property="article:published_time" content="2015-01-17T08:00:00+02:00" /><meta property="article:modified_time" content="2015-01-26T00:30:00+02:00 " /><link rel="canonical" href="https://codesi.nz/npm-package-automation-with-packo/"><meta name="”twitter:creator”" value=""><meta name="twitter:card" content="summary_large_image"><meta name="twitter:url" content="https://codesi.nz/npm-package-automation-with-packo/"><meta name="twitter:title" content="Npm package automation with packo"><meta name="twitter:description" content="Developing NodeJS applications for the past year meant that I often found myself in front of monolythic applications, that clunked all-things-functionality in 3 or 4 so-called libraries. I’m not a huge fan of compiled languages, and after college I was really reluctant towards languages like Java, but one thing I really learned to appreciate is the modularity that you can reach with it, especially with statements like import package.*;. "><meta name="twitter:image" content="https://codesi.nz/images/posts/automation.jpg"><link rel="prefetch" href="/three-hard-to-spot-javascript-mistakes/"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="codesins. - The blog of Adrian Oprea, freelance web developer."><link rel="author" href="https://plus.google.com/+AdrianOpreasWeb/"><link rel="publisher" href="https://plus.google.com/+AdrianOpreasWeb/"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/normalize/4.0.0/normalize.min.css"><link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,300italic,700,400italic,600,600italic,700italic,800,800italic' rel='stylesheet' type='text/css'><link href='https://fonts.googleapis.com/css?family=Lato:100,300,900' rel='stylesheet' type='text/css'><link rel="stylesheet" href="/stylesheets/screen.css"><link rel="stylesheet" href="/stylesheets/monokai.css"> <script> var host = "codesi.nz"; if ((host == window.location.host) && (window.location.protocol != "https:")) { window.location.protocol = "https"; } </script><body><div class="header"><div role="branding" class="branding"><h1><a href="/" title="Go back to the homepage">codesins.</a></h1></div><div class="navigation"><nav role="navigation"><ul><li class="active" ><a title="Navigate to the blog" href="/">Blog</a><li ><a title="Find out more about me" href="/about/">Who am I</a><li ><a title="Go to the contact page" href="/contact/">Let's chat</a></ul></nav></div></div><article class="article-full" itemprop="blogPosts" itemscope itemtype="https://schema.org/BlogPosting"><meta itemprop="datePublished" content="2015-01-17T08:00:00+02:00"><meta itemprop="dateModified" content="2015-01-26T00:30:00+02:00"><meta itemprop="keywords" content="nodejs, workflow, automation, npm, packages, cli"><meta itemprop="author" content="Adrian Oprea"><meta itemprop="inLanguage" content="en_US"> <span itemprop="audience" itemscope itemtype="http://schema.org/PeopleAudience"><meta itemprop="gender" content="any"> </span><header class="article-header"><h1 class="article-header__heading article-header__heading--center article-header__heading--white" itemprop="headline">Npm package automation with packo</h1><div class="article-info article-info--delimited"><div class="article-info-inner"> <a class="article-info__author-profile" href="/about" title="About the author: Adrian Oprea"> <img class="article-info__author-image" src="/images/assets/adrian_oprea.png" alt="Author image: Adrian Oprea"> </a><p> Adrian Oprea on <time itemProp="datePublished" datetime="2015-01-17T08:00:00+02:00">17 Jan 2015</time><br> Published in <span class="categories-list"> <span class="categories-list-item">nodejs</span> </span></div></div></header><main class="article-body" itemprop="articleBody"><p>Developing NodeJS applications for the past year meant that I often found myself in front of monolythic applications, that clunked all-things-functionality in 3 or 4 so-called libraries.<br /> I’m not a huge fan of compiled languages, and after college I was really reluctant towards languages like Java, but one thing I really learned to appreciate is the modularity that you can reach with it, especially with statements like <code class="highlighter-rouge">import package.*;</code>.<p>Not to say that NodeJS doesn’t have a similar system, it’s just that we’re using it wrong. We tend to stack functionality in one file, just because “we think” it belongs to that “module”. In fact, the “module” is not a module at all, as in the majority of cases, I found JavaScript files that had a huge, 300+ lines of code function as <code class="highlighter-rouge">module.exports</code>, and that would be included in the application using <code class="highlighter-rouge">require('../somefolder/module);</code>.<br /> To me, this seems like a whole lot of coupling, just because you have to actually “crawl” through the application’s directory structure like that. Think what it would be like, to have to include that file in 3 more places, in other areas of the application. If further down the road you decide to refactor the module and place it in a <code class="highlighter-rouge">lib/</code> folder, things start to get complicated, as now you have to update all the different paths in the application using the following workflow: open file-&gt;update-&gt;save-&gt;reload application-&gt;check logs/ui for errors.<br /> Wouldn’t it have been easier to simply type this: <code class="highlighter-rouge">require('my-super-package');</code>?<br /> The answer for me is YES, and for this exact purpose I built <a href="https://www.npmjs.com/package/packo">packo</a>, a npm package generator that takes away the work of having to manually create your package’s boilerplate structure, and all of this while keeping best practices in mind.<h2 class="no_toc" id="table-of-contents">Table of contents</h2><ul id="markdown-toc"><li><a href="#reasoning" id="markdown-toc-reasoning">Reasoning</a><li><a href="#usage" id="markdown-toc-usage">Usage</a><li><a href="#update-1" id="markdown-toc-update-1">UPDATE 1.</a></ul><h2 id="reasoning">Reasoning</h2><p>While analysing the codebase that I currently work with at the office, I advocated the idea that we should rebuild/rething some of our modules as npm packages, and just install them through <code class="highlighter-rouge">npm install</code>. But given the fact that I work for a company that heavily manipulates sensitive user data, we cannot afford to have all our code published on <a href="http://npmjs.com">npmjs.com</a>, so we hit a roadblock. Fortunately, <a href="https://github.com/npm/npm">npm</a> is open source, so this means that we can configure it to work with an internally-managed repository. With this out of the way, my thoughts went to all those tens of thousands of lines of code, and how they will fit nicely into their own packages, until I realised that for each of these packages I have to create the folder structure, <code class="highlighter-rouge">touch</code> the JavaScript files, create the <code class="highlighter-rouge">package.json</code>, all of these BY HAND and without a solid understanding on what are the best practices in terms of directory structure. So I started to investigate the way popular npm packages are structured, and for this I took the top 6 packages on <a href="http://npmjs.com">npmjs.com</a> – <a href="https://www.npmjs.com/packages/browserify">browserify</a>, <a href="https://www.npmjs.com/packages/express">express</a>, <a href="https://www.npmjs.com/packages/pm2">pm2</a>, <a href="https://www.npmjs.com/packages/grunt-cli">grunt-cli</a>, <a href="https://www.npmjs.com/packages/npm">npm</a>, <a href="https://www.npmjs.com/packages/karma">karma</a> – and tried to spot patterns in their structure, and I found that the most commonly used directory structure is the following:<div class="highlighter-rouge"><pre class="highlight"><code>    package/
        bin/
        doc/
        examples/
        lib/
        <span class="nb">test</span>/
</code></pre></div><p>so I made <a href="https://www.npmjs.com/package/packo">packo</a> create this exact directory structure.<br /> I also added preference files for various tools, but this was more of a personal touch, as I use <a href="http://editorconfig.org/">EditorConfig</a> to have an uniform editor/IDE configuration accross platforms and machines, and I also like to validate my code using <a href="http://jshint.com/">JSHint</a> as it is more relaxed, and less opinionated than other tools out there.<h2 id="usage">Usage</h2><p>In order to use packo you need to install it globally, so you will need to open a terminal window and type: <code class="highlighter-rouge">$ npm install -g packo</code><p>After npm has finished installing it, you’re ready to scaffold your first package, so navigate to your <code class="highlighter-rouge">Projects/</code> folder and run the following command:<div class="highlighter-rouge"><pre class="highlight"><code>    <span class="nv">$ </span>packo create awesome-package
    This utility will walk you through creating a package.json file.
    It only covers the most common items, and tries to guess sane defaults.

    See <span class="sb">`</span>npm <span class="nb">help </span>json<span class="sb">`</span> <span class="k">for </span>definitive documentation on these fields
    and exactly what they <span class="k">do</span>.

    Use <span class="sb">`</span>npm install &lt;pkg&gt; --save<span class="sb">`</span> afterwards to install a package and
    save it as a dependency <span class="k">in </span>the package.json file.

    Press ^C at any <span class="nb">time </span>to quit.
    name: <span class="o">(</span>awesome-package<span class="o">)</span>
    version: <span class="o">(</span>1.0.0<span class="o">)</span>
    description: Npm package authoring just got better!
    entry point: <span class="o">(</span>index.js<span class="o">)</span>
    <span class="nb">test command</span>: npm <span class="nb">test
    </span>git repository:
    keywords: scaffolding, node_modules
    author: Adrian Oprea
    license: <span class="o">(</span>ISC<span class="o">)</span> MIT
    About to write to /Users/adrianoprea/Projects/awesome-package/package.json:
</code></pre></div><p>After this message, if you hit <code class="highlighter-rouge">RETURN</code>, <code class="highlighter-rouge">package.json</code> will be generated and you’re all done, your package is available in the <code class="highlighter-rouge">awesome-package</code> directory.<p>More info about how to use packo is available on the project’s npm page, so be sure to check it out: <a href="https://www.npmjs.com/package/packo">https://www.npmjs.com/package/packo</a>.<p>I really appreciate feedback, so if you have some suggestions, be sure to tweet me – <a href="https://twitter.com/opreaadrian">@opreaadrian</a>, or get in touch via the <a href="https://github.com/opreaadrian/packo/issues">project’s issues board</a>, on GitHub.<h2 id="update-1">UPDATE 1.</h2><p><a href="https://www.npmjs.com/package/packo">packo</a> just got better! It now has a new subcommand – <code class="highlighter-rouge">packo module</code> – which allows developers to add library files along with their respective spec file to the package they’re currently working on.<div class="highlighter-rouge"><pre class="highlight"><code>    adrianoprea at mothership <span class="k">in</span> ~/awesome-package
    <span class="nv">$ </span>packo module dataReader
    Successfully created lib/dataReader.js module and <span class="nb">test</span>/dataReader_spec.js.
    adrianoprea at mothership <span class="k">in</span> ~/awesome-package
    <span class="nv">$ </span>ls <span class="nb">test</span>/
    dataReader_spec.js
    adrianoprea at mothership <span class="k">in</span> ~/awesome-package
    <span class="nv">$ </span>ls lib/
    dataReader.js
    adrianoprea at mothership <span class="k">in</span> ~/awesome-package
    <span class="nv">$ </span>ls -l lib/
</code></pre></div><p>Note that in order to use this feature you must be inside of an npm package folder(not necessarily created w/ <code class="highlighter-rouge">packo create</code>).<br /> It is mandatory for the package to have a <code class="highlighter-rouge">package.json</code> file as packo looks for that specific file in order to know that it is inside a package root file.<br /> In the future, packo will have it’s own <code class="highlighter-rouge">.preferences</code> file and we’ll perform detection based on that.<p>Please make sure to send some feedback so we can take development further and have a useful tool that gets out of your way and lets you focus on your work better.<blockquote><p>Image credits: <a href="https://flic.kr/p/PFDgo">Ovagraph</a> by <a href="https://www.flickr.com/photos/jurvetson/">Steve Jurvetson</a></blockquote></main><footer class="article-footer"><section><h3>Spread the word</h3><span class='st_facebook_large' displayText='Facebook'></span> <span class='st_twitter_large' displayText='Tweet'></span> <span class='st_linkedin_large' displayText='LinkedIn'></span> <span class='st_email_large' displayText='Email'></span> <span class='st_reddit_large' displayText='Reddit'></span> <span class='st_googleplus_large' displayText='Google +'></span> <span class='st_pinterest_large' displayText='Pinterest'></span></section><div class="pagination" role="navigation"> <a href="/three-hard-to-spot-javascript-mistakes/" title="Next article: Npm package automation with packo" role="next">Three hard to spot JavaScript mistakes &rarr;</a></div><div id="disqus_thread"></div><script> (function() { var d = document, s = d.createElement('script'); s.src = '//codesinz.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></footer></article><script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-32468134-4', 'auto'); ga('require', 'displayfeatures'); ga('send', 'pageview'); </script> <script type="text/javascript"> var _dcq = _dcq || []; var _dcs = _dcs || {}; _dcs.account = '9282313'; (function() { var dc = document.createElement('script'); dc.type = 'text/javascript'; dc.async = true; dc.src = '//tag.getdrip.com/9282313.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(dc, s); })(); </script> <script type="text/javascript">var switchTo5x=true;</script> <script type="text/javascript" src="//ws.sharethis.com/button/buttons.js"></script> <script type="text/javascript">stLight.options({publisher: "92204b4b-884e-4a7f-9337-a39d86c8b368", doNotHash: true, doNotCopy: false, hashAddressBar: true, shorten: false});</script>
