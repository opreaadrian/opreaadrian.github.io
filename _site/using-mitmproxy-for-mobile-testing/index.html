<!DOCTYPE html><html lang="en" itemscope itemtype="https://schema.org/Blog"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Quick tip: Using mitmproxy for mobile testing</title><meta name="keywords" content="mobile, testing, mitmproxy, hosts, hostfile, nodejs"><meta name="author" itemprop="creator" content="Adrian Oprea"><meta name="description" itemprop="description" content="This article is meant to offer a hopefully simple solution for testing web applications that run on your local machine, on actual mobile devices, without altering your router’s DNS configuration, or resorting to other, less elegant solutions. "><meta property="og:type" content="article" /><meta property="og:title" content="Quick tip: Using mitmproxy for mobile testing" /><meta property="og:description" content="This article is meant to offer a hopefully simple solution for testing web applications that run on your local machine, on actual mobile devices, without altering your router’s DNS configuration, or resorting to other, less elegant solutions. " /><meta property="og:image" content="https://codesi.nz/images/posts/using-mitmproxy-for-mobile-testing/post.jpg" /><meta property="og:url" content="https://codesi.nz/using-mitmproxy-for-mobile-testing/" /><meta property="og:locale" content="en_US" /><meta property="article:published_time" content="2015-11-24T12:00:00+02:00" /><meta property="article:modified_time" content="2015-11-24T12:00:00+02:00 " /><link rel="canonical" href="https://codesi.nz/using-mitmproxy-for-mobile-testing/"><meta name="”twitter:creator”" value=""><meta name="twitter:card" content="summary_large_image"><meta name="twitter:url" content="https://codesi.nz/using-mitmproxy-for-mobile-testing/"><meta name="twitter:title" content="Quick tip: Using mitmproxy for mobile testing"><meta name="twitter:description" content="This article is meant to offer a hopefully simple solution for testing web applications that run on your local machine, on actual mobile devices, without altering your router’s DNS configuration, or resorting to other, less elegant solutions. "><meta name="twitter:image" content="https://codesi.nz/images/posts/using-mitmproxy-for-mobile-testing/post.jpg"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="codesins. - The blog of Adrian Oprea, freelance web developer."><link rel="author" href="https://plus.google.com/+AdrianOpreasWeb/"><link rel="publisher" href="https://plus.google.com/+AdrianOpreasWeb/"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/normalize/4.0.0/normalize.min.css"><link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,300italic,700,400italic,600,600italic,700italic,800,800italic' rel='stylesheet' type='text/css'><link href='https://fonts.googleapis.com/css?family=Lato:100,300,900' rel='stylesheet' type='text/css'><link rel="stylesheet" href="/stylesheets/screen.css"><link rel="stylesheet" href="/stylesheets/monokai.css"> <script> var host = "codesi.nz"; if ((host == window.location.host) && (window.location.protocol != "https:")) { window.location.protocol = "https"; } </script><body><div class="header"><div role="branding" class="branding"><h1><a href="/" title="Go back to the homepage">codesins.</a></h1></div><div class="navigation"><nav role="navigation"><ul><li class="active" ><a title="Navigate to the blog" href="/">Blog</a><li ><a title="Find out more about me" href="/about/">Who am I</a><li ><a title="Go to the contact page" href="/contact/">Let's chat</a></ul></nav></div></div><article class="article-full" itemprop="blogPosts" itemscope itemtype="https://schema.org/BlogPosting"><meta itemprop="datePublished" content="2015-11-24T12:00:00+02:00"><meta itemprop="dateModified" content="2015-11-24T12:00:00+02:00"><meta itemprop="keywords" content="mobile, testing, mitmproxy, hosts, hostfile, nodejs"><meta itemprop="author" content="Adrian Oprea"><meta itemprop="inLanguage" content="en_US"> <span itemprop="audience" itemscope itemtype="http://schema.org/PeopleAudience"><meta itemprop="gender" content="any"> </span><header class="article-header"><h1 class="article-header__heading article-header__heading--center article-header__heading--white" itemprop="headline">Quick tip: Using mitmproxy for mobile testing</h1><div class="article-info article-info--delimited"><div class="article-info-inner"> <a class="article-info__author-profile" href="/about" title="About the author: Adrian Oprea"> <img class="article-info__author-image" src="/images/assets/adrian_oprea.png" alt="Author image: Adrian Oprea"> </a><p> Adrian Oprea on <time itemProp="datePublished" datetime="2015-11-24T12:00:00+02:00">24 Nov 2015</time><br> Published in <span class="categories-list"> <span class="categories-list-item">development</span> </span></div></div></header><main class="article-body" itemprop="articleBody"><p>This article is meant to offer a hopefully simple solution for testing web applications that run on your local machine, on actual mobile devices, without altering your router’s DNS configuration, or resorting to other, less elegant solutions.<h2 class="no_toc" id="table-of-contents">Table of contents</h2><ul id="markdown-toc"><li><a href="#use-case" id="markdown-toc-use-case">Use case</a><li><a href="#solution-1" id="markdown-toc-solution-1">Solution 1</a><li><a href="#solution-2" id="markdown-toc-solution-2">Solution 2</a><li><a href="#how-dns-resolution-works" id="markdown-toc-how-dns-resolution-works">How DNS resolution works</a><li><a href="#the-setup" id="markdown-toc-the-setup">The setup</a><li><a href="#workflow" id="markdown-toc-workflow">Workflow</a><li><a href="#proxy-server-setup" id="markdown-toc-proxy-server-setup">Proxy server setup</a><li><a href="#iphone-proxy-setup" id="markdown-toc-iphone-proxy-setup">iPhone proxy setup</a></ul><h2 id="use-case">Use case</h2><p>I have an application running on my machine, and I access it on <code class="highlighter-rouge">http://myapp.dev</code> as it depends on the domain it is running on, in order to bootstrap itself and offer different functionality based on the domain where it is being loaded.<br /> I want to be able to navigate to <code class="highlighter-rouge">http://myapp.dev</code> on my phone and get the application running on my computer.<h2 id="solution-1">Solution 1</h2><p>Have the mapping added to my local DNS(the router’s DNS) and every time a device on my network navigates to <code class="highlighter-rouge">http://myapp.dev</code> it will be redirected to my machine — highly impractical as I have multiple devices and I’d probably like to keep my router’s config as sane as possible.<h2 id="solution-2">Solution 2</h2><p>Set my computer as a <a href="https://en.wikipedia.org/wiki/Man-in-the-middle_attack" title="Wikipedia link to Man-In-The-Middle attack definition" target="_blank">Man-In-The-Middle</a> between my phone and the Internet — in other words, make my computer act as an HTTP proxy. This way, I can trick the phone into believeing that all its traffic needs to be routed through my laptop.<h2 id="how-dns-resolution-works">How DNS resolution works</h2><ul><li>I navigate to <code class="highlighter-rouge">http://myapp.dev</code> from my phone<li>My phone looks at its internal hostfile — usually <code class="highlighter-rouge">/etc/hosts</code> on UNIX-like operating systems — for entries resolving to that specific hostname.<li>If it doesn’t find anything it looks at the local DNS (the router’s DNS)<li>If no result is returned by the local DNS, then the external DNS is queried - via recursion<li>If nothing comes back from the external DNS, then it means that the address is either inexistent or down.</ul><h2 id="the-setup">The setup</h2><ul><li>A copy of <a href="https://mitmproxy.org/" title="Link to mitmproxy official website" target="_blank">mitmproxy</a><li>A mobile device to test on</ul><h2 id="workflow">Workflow</h2><p>What I want to do is to trick my phone into thinking that <code class="highlighter-rouge">http://myapp.dev</code> resolves to 192.168.xxx.xxx — my laptop’s local IP address — and the way I can do that is by using <a href="https://mitmproxy.org/" title="Link to mitmproxy official website" target="_blank">mitmproxy</a>.<p>If you’re on a Mac, you have two options for installing <code class="highlighter-rouge">mitmproxy</code>:<ul><li>Through <a href="https://pip.pypa.io/en/stable/" title="Link to Python package manager, pip" target="_blank">pip</a> by issuing <code class="highlighter-rouge">pip install mitmproxy</code> at your terminal prompt.<li>Through <a href="http://brew.sh/" title="Link to Homebrew - Mac OS X package manager" target="_blank">homebrew</a> by issuing another command at your terminal prompt: <code class="highlighter-rouge">brew install mitmproxy</code>.</ul><p>If you are on a different operating system please check the <a href="http://docs.mitmproxy.org/en/stable/install.html" title="Mitmproxy official installation docs" target="_blank">mitmproxy installation guide</a><h2 id="proxy-server-setup">Proxy server setup</h2><p>All you have to do now is to start the proxy server, and set your machine’s local IP (192.168.xxx.xxx) as the proxy through which the phone connects to the Internet.<div class="highlighter-rouge"><pre class="highlight"><code><span class="c"># Start the proxy server on port 7654</span>
<span class="gp">$ </span>mitmproxy -p 7654
</code></pre></div><p>After starting the proxy server go to your phone’s wireless network settings, and add your computer’s ip as an HTTP proxy that every connection on your phone goes through.<br /> Note that the phone and the computer need to be on the same network, or otherwise you will need to get the public IP that your computer uses when it accesses the Internet.<div class="highlighter-rouge"><pre class="highlight"><code><span class="c"># UNIX - Get your computer's router-assigned IP (see image below)</span>
<span class="gp">$ </span>ifconfig -a | grep inet

<span class="c"># Windows - Get the network configuration for all interfaces</span>
<span class="gp">&gt; </span>ipconfig /all
</code></pre></div><figure> <img src="/images/posts/using-mitmproxy-for-mobile-testing/ifconfig.png" alt="Image of the output of the ifconfig command on UNIX like systems." /></figure><h2 id="iphone-proxy-setup">iPhone proxy setup</h2><p>In order to add a proxy to your wireless connection, navigate to “Settings -&gt; Wi-Fi”, find the network you whish to connect to and tap the “i” symbol, to the far right of the network’s name.<br /> This will move you to the network’s settings panel, and at the bottom of this panel you have the “HTTP PROXY” section, which is set to “Off” by default.<br /> Tap “Manual” and add your machine’s IP and the port you used when you started <code class="highlighter-rouge">mitmproxy</code>. The setup should look like the image below.<figure> <img src="/images/posts/using-mitmproxy-for-mobile-testing/iphone-proxy.png" alt="Image of HTTP PROXY settings on the iPhone" /></figure><p>Once you’re done performing the steps above, you should try and visit any web page, and you will see some activity in the terminal window where you started <code class="highlighter-rouge">mitmproxy</code>.<br /> This means that the proxy is working correctly and that your phone’s connection is routed through your laptop.<br /> Now, you can start your application on your machine, add an entry to your <code class="highlighter-rouge">/etc/hosts</code> file, that makes <code class="highlighter-rouge">myapp.dev</code> point to your local machine’s IP, and visit <code class="highlighter-rouge">http://myapp.dev:&lt;port&gt;</code> from your phone.<p>You’re done! You should now be able to see the application that is running on your computer.<blockquote><p>Credits: <br /> <a href="https://www.flickr.com/photos/believekevin/">kevin</a> — <a href="https://flic.kr/p/8mGycA">Lot of mobile phones + accessories (FREE)</a></blockquote></main><footer class="article-footer"><section><h3>Spread the word</h3><span class='st_facebook_large' displayText='Facebook'></span> <span class='st_twitter_large' displayText='Tweet'></span> <span class='st_linkedin_large' displayText='LinkedIn'></span> <span class='st_email_large' displayText='Email'></span> <span class='st_reddit_large' displayText='Reddit'></span> <span class='st_googleplus_large' displayText='Google +'></span> <span class='st_pinterest_large' displayText='Pinterest'></span></section><div class="pagination" role="navigation"> <a href="/there-s-garbage-in-our-code/" title="Previous article: Quick tip: Using mitmproxy for mobile testing" role="prev">&larr; There's garbage in our code</a> <a href="/bite-sized-javascript-meet-array/" title="Next article: Quick tip: Using mitmproxy for mobile testing" role="next">Bite-sized JavaScript - Meet Array &rarr;</a></div><div id="disqus_thread"></div><script> (function() { var d = document, s = d.createElement('script'); s.src = '//codesinz.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></footer></article><script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-32468134-4', 'auto'); ga('require', 'displayfeatures'); ga('send', 'pageview'); </script> <script type="text/javascript"> var _dcq = _dcq || []; var _dcs = _dcs || {}; _dcs.account = '9282313'; (function() { var dc = document.createElement('script'); dc.type = 'text/javascript'; dc.async = true; dc.src = '//tag.getdrip.com/9282313.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(dc, s); })(); </script> <script type="text/javascript">var switchTo5x=true;</script> <script type="text/javascript" src="//ws.sharethis.com/button/buttons.js"></script> <script type="text/javascript">stLight.options({publisher: "92204b4b-884e-4a7f-9337-a39d86c8b368", doNotHash: true, doNotCopy: false, hashAddressBar: true, shorten: false});</script>
