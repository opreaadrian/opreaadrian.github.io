<!DOCTYPE html>
<html lang="en" itemscope itemtype="https://schema.org/Blog">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <title>Serializing object methods using ES6 template strings and eval</title>
  <meta name="keywords" content="javascript, hacks, tricks, es6, ecmascript 6, es2015, template strings, json, stringify">
  <meta name="author" itemprop="creator" content="Adrian Oprea">
  <meta name="description" itemprop="description" content="Understanding the way AJAX and JSON manipulation work in JavaScript could make 
the difference between writing an elegant, easy to reason about application, 
and a crude hack. As far as my experience goes, only a small number of developers 
I’ve talked to in the past year or so, know how to write a vanilla 
XMLHttpRequest, from scratch. I do agree that it is important to get the 
job done in a timely manner and not reinvent the wheel, but using something 
without understanding it’s substance is something that I cannot come to terms 
with, for someone other than a junior developer.

">
<meta property="og:type" content="article" />
<meta property="og:title" content="Serializing object methods using ES6 template strings and eval" />
<meta property="og:description" content="Understanding the way AJAX and JSON manipulation work in JavaScript could make 
the difference between writing an elegant, easy to reason about application, 
and a crude hack. As far as my experience goes, only a small number of developers 
I’ve talked to in the past year or so, know how to write a vanilla 
XMLHttpRequest, from scratch. I do agree that it is important to get the 
job done in a timely manner and not reinvent the wheel, but using something 
without understanding it’s substance is something that I cannot come to terms 
with, for someone other than a junior developer.

" />
<meta property="og:image" content="https://codesi.nz/images/posts/serializing-object-methods-using-es6-template-strings-and-eval/post.jpg" />
<meta property="og:url" content="https://codesi.nz/serializing-object-methods-with-ES6-template-strings-and-eval/" />
<meta property="og:locale" content="en_US" />
<meta property="article:published_time" content="2016-02-29T14:30:00+02:00" />
<meta property="article:modified_time" content="2016-03-01T11:00:00+02:00 " />
<link rel="canonical" href="https://codesi.nz/serializing-object-methods-with-ES6-template-strings-and-eval/">

<!-- Twitter Card -->
<meta name="”twitter:creator”" value="">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:url" content="https://codesi.nz/serializing-object-methods-with-ES6-template-strings-and-eval/">
<meta name="twitter:title" content="Serializing object methods using ES6 template strings and eval">
<meta name="twitter:description" content="Understanding the way AJAX and JSON manipulation work in JavaScript could make 
the difference between writing an elegant, easy to reason about application, 
and a crude hack. As far as my experience goes, only a small number of developers 
I’ve talked to in the past year or so, know how to write a vanilla 
XMLHttpRequest, from scratch. I do agree that it is important to get the 
job done in a timely manner and not reinvent the wheel, but using something 
without understanding it’s substance is something that I cannot come to terms 
with, for someone other than a junior developer.

">
<meta name="twitter:image" content="https://codesi.nz/images/posts/serializing-object-methods-using-es6-template-strings-and-eval/post.jpg">

  

<link type="application/atom+xml" rel="alternate" href="/feed.xml" title="codesins. - The blog of Adrian Oprea, freelance web developer.">

  
    <link rel="author" href="https://plus.google.com/+AdrianOpreasWeb/">
    <link rel="publisher" href="https://plus.google.com/+AdrianOpreasWeb/">
  


  <!-- syntax highlighting CSS -->
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/normalize/4.0.0/normalize.min.css">
<link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,300italic,700,400italic,600,600italic,700italic,800,800italic' rel='stylesheet' type='text/css'>
<link href='https://fonts.googleapis.com/css?family=Lato:100,300,900' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="/stylesheets/screen.css">

  <script>
  var host = "codesi.nz";
  if ((host == window.location.host) && (window.location.protocol != "https:")) {
    window.location.protocol = "https";
  }
</script>


</head>
<body>

  <div class="header">
  <div role="branding" class="branding">
    <h1><a href="/" title="Go back to the homepage">codesins.</a></h1>
  </div>

  <div class="navigation">
    <nav role="navigation">
      <ul>
        <li 
          
              class="active" 
          
        ><a title="Navigate to the blog" href="/">Blog</a></li>
        <li ><a title="Find out more about me" href="/about">Who am I</a></li>
        <li ><a title="Go to the contact page" href="/contact">Let's chat</a></li>
      </ul>
    </nav>
  </div>
</div>

  <article class="article-full" itemprop="blogPosts" itemscope itemtype="https://schema.org/BlogPosting">
  <meta itemprop="datePublished" content="2016-02-29T14:30:00+02:00">
  <meta itemprop="dateModified" content="2016-03-01T11:00:00+02:00">
  <meta itemprop="keywords" content="javascript, hacks, tricks, es6, ecmascript 6, es2015, template strings, json, stringify">
  <meta itemprop="author" content="Adrian Oprea">
  
    <meta itemprop="inLanguage" content="en_US">
  

  <!-- DIVERSITY IS KEY -->
  <span itemprop="audience" itemscope itemtype="http://schema.org/PeopleAudience">
      <meta itemprop="gender" content="any">
  </span>
  <header class="article-header">
    <h1 class="article-header__heading article-header__heading--center article-header__heading--white" itemprop="headline">Serializing object methods using ES6 template strings and eval</h1>
    <div class="article-info article-info--delimited">
  <div class="article-info-inner">
    <a class="article-info__author-profile" href="/about" title="About the author: Adrian Oprea">
      <img class="article-info__author-image" src="/images/assets/adrian_oprea.png" alt="Author image: Adrian Oprea">
    </a>
    <p>
    Adrian Oprea on <time itemProp="datePublished" datetime="2016-02-29T14:30:00+02:00">29 Feb 2016</time><br>
     
    Published in 
    <span class="categories-list">
      
      <span class="categories-list-item">javascript</span>
      
      <span class="categories-list-item">experiments</span>
      
    </span>
    
    </p>
  </div>
</div>

  </header>

  <main class="article-body" itemprop="articleBody">
    <p>Understanding the way AJAX and JSON manipulation work in JavaScript could make 
the difference between writing an elegant, easy to reason about application, 
and a crude hack. As far as my experience goes, only a small number of developers 
I’ve talked to in the past year or so, know how to write a vanilla 
<code class="highlighter-rouge">XMLHttpRequest</code>, from scratch. I do agree that it is important to get the 
job done in a timely manner and not reinvent the wheel, but using something 
without understanding it’s substance is something that I cannot come to terms 
with, for someone other than a junior developer.</p>

<h2 id="a-bit-of-background">A bit of background</h2>

<p>I’ve been working with JSON since 2009 and all I knew is that you are able to 
serialize JavaScript objects, by using <code class="highlighter-rouge">JSON.stringify</code> but only the properties
(values) get serialized, and the methods get left behind.
I started looking into the literature around JSON serialization in JavaScript 
and the only information I found on JSON.org and the Mozilla Developer Network 
confirmed what I already said before, so then I started to think about the 
“forbidden” parts of JavaScript.</p>

<p>In my case, I started learning JavaScript reading
<a href="http://amzn.com/0596517742">JavaScript The Good Parts</a> written by 
<a href="http://crockford.com/">Douglas Crockford</a> and if you’re like me, 
the rest of your career was highly influenced by that book and Crockford’s 
approach to JavaScript and software development. But everything comes at a cost, 
and the cost I had to pay was believing too much in the “Eval is evil” mantra.</p>

<h2 id="what-is-json">What is JSON?</h2>

<p>First, let’s start with some basics, namely, let’s see what JSON is.</p>

<p>According to <a href="http://www.json.org/">JSON.org</a>:</p>

<blockquote>
  <p>JSON (JavaScript Object Notation) is a lightweight data-interchange format. […]
JSON is a text format that is completely language independent but uses 
conventions that are familiar to programmers of the C-family of languages […]</p>
</blockquote>

<p>According to the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON">Mozilla Developer Network</a></p>

<blockquote>
  <p>JSON is a syntax for serializing objects, arrays, numbers, strings, booleans, 
and null. It is based upon JavaScript syntax but is distinct from it: 
some JavaScript is not JSON, and some JSON is not JavaScript.</p>
</blockquote>

<p>Both definitions tell us one thing: JSON is a format for distributing data 
across “the wire” and can be easily understood and generated by both 
humans and computers.</p>

<h2 id="what-is-serialization">What is serialization?</h2>

<p>Again, in order to continue, we first need to establish what serialization is, 
and without having to resort to external resources for this, I will give you 
my own definition: “Serialization is a process through which one data format gets 
translated to an intermediary data format, for the purpose of distribution”.</p>

<p>The reverse of serialization is de-serialization, where you take a the 
intermediary data format and turn it back into its original form, so you can 
manipulate it and use it in your application.<br />
Now, with theory out of the way, let’s get to the code.</p>

<h2 id="object-serialization-and-the-replacer-function">Object serialization and the <strong>replacer</strong> function</h2>

<p>Based on the knowledge we have at this point, we can now demonstrate how exactly 
serialization works, so let’s take an object, run it through <code class="highlighter-rouge">JSON.stringify</code> 
and see what we get.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="s1">'use strict'</span><span class="p">;</span>

<span class="kd">let</span> <span class="nx">person</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">name</span><span class="p">:</span> <span class="s1">'Susan'</span><span class="p">,</span>
  <span class="na">age</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span>
  <span class="na">sayHi</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Susan says hi!'</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="kr">const</span> <span class="nx">serialized</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">person</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">serialized</span><span class="p">);</span> <span class="c1">// {"name":"Susan","age":24} </span>

<span class="k">typeof</span> <span class="nx">serialized</span> <span class="o">===</span> <span class="s1">'string'</span> <span class="c1">// true</span></code></pre></figure>

<p>As you can see, the <code class="highlighter-rouge">sayHi</code> method is nowhere to be seen. The reason is that 
<code class="highlighter-rouge">JSON.stringify</code> serializes only the properties of the object, leaving its 
methods behind.<br />
Now, let’s say we want to also serialize the <code class="highlighter-rouge">sayHi</code> method. How would we go about 
that? First, let’s take a look at <code class="highlighter-rouge">JSON.stringify</code>’s signature, outlined below.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">value</span><span class="p">[,</span> <span class="nx">replacer</span><span class="p">[,</span> <span class="nx">space</span><span class="p">]])</span>

<span class="c1">// =&gt; value(required) - the object we want to serialize </span>
<span class="c1">// =&gt; replacer(optional) - a function that will be called for each of the </span>
<span class="c1">//    object's properties, or an array of strings and numbers that serve </span>
<span class="c1">//    as a whitelist for the property selection process</span>
<span class="c1">// =&gt; space(optional) - the number of spaces each key will receive as indent</span></code></pre></figure>

<p>Our main interest is the <code class="highlighter-rouge">replacer</code> argument, and we are going to use its function form. In order 
for this trick to work and for the <code class="highlighter-rouge">sayHi</code> method’s code to be properly converted to a string, 
we can call its <code class="highlighter-rouge">toString()</code> method.<br />
Calling <code class="highlighter-rouge">toString()</code> on a function, returns a string representation of the function’s body. 
This way, if we call <code class="highlighter-rouge">person.sayHi.toString()</code> we will get the following output:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="s2">"function () { console.log('Susan says hi!'); }"</span></code></pre></figure>

<p>So now that we know how to get our method’s body, let’s build the logic to serialize the whole 
<code class="highlighter-rouge">person</code> object, including its method.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="s1">'use strict'</span><span class="p">;</span>

<span class="kd">let</span> <span class="nx">person</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">name</span><span class="p">:</span> <span class="s1">'Susan'</span><span class="p">,</span>
  <span class="na">age</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span>
  <span class="na">sayHi</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Susan says hi!'</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="kd">let</span> <span class="nx">replacer</span> <span class="o">=</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// if we get a function, give us the code for that function</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">value</span> <span class="o">===</span> <span class="s1">'function'</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">value</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// get a stringified version of our object, and indent the keys at 2 spaces</span>
<span class="kr">const</span> <span class="nx">serialized</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">person</span><span class="p">,</span> <span class="nx">replacer</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">serialized</span><span class="p">);</span> 
<span class="c1">// {"name":"Susan","age":24,"sayHi":"function () {\n\tconsole.log('Susan says hi!');\n  }"}</span></code></pre></figure>

<h2 id="de-serialization-and-reviving-properties">De-serialization and reviving properties</h2>

<p>As you can see, we now have our method, properly serialized and ready for 
transportation “across the wire”. What we need to do next is to de-serialize 
our object and make the <code class="highlighter-rouge">sayHi</code> method executable, again, and this can be 
accomplished using <code class="highlighter-rouge">JSON.parse</code>.</p>

<p>Similar to what we did with <code class="highlighter-rouge">JSON.stringify</code>, we will have to take a look at 
<code class="highlighter-rouge">JSON.parse</code>’s signature in order to get a clearer view of how we will 
perform the de-serialization process in such a way that we can convert our 
current <code class="highlighter-rouge">sayHi</code> string into a function, again.</p>

<p><code class="highlighter-rouge">JSON.parse</code> has the following signature, according to the Mozilla Developer Network:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">text</span><span class="p">[,</span> <span class="nx">reviver</span><span class="p">])</span>

<span class="c1">// =&gt; text(required) - the string we wish to de-serialize and convert back</span>
<span class="c1">//    to a standard JavaScript object(JSON)</span>
<span class="c1">// =&gt; reviver(optional) - function used to pre-process keys and values in order </span>
<span class="c1">//    to render a specific object structure</span></code></pre></figure>

<p>Before going any further with the solution, let’s first see what template 
strings are, at their most basic level.
According to MDN, template literals(usually called template strings) are string 
literals that allow embedded expressions. To simplify this explanation, let’s 
take a look at a piece of code using ES6 template strings and compare it to the 
way we used to mimic this in ES5.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">//ES6 template strings</span>
<span class="kd">let</span> <span class="nx">someComputedValue</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">+</span> <span class="mi">3</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">theTemplate</span> <span class="o">=</span> <span class="err">`</span><span class="nx">This</span> <span class="nx">is</span> <span class="nx">the</span> <span class="nx">result</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">computation</span><span class="err">:</span> <span class="nx">$</span><span class="p">{</span><span class="nx">someComputedValue</span><span class="p">}</span><span class="err">`</span><span class="p">;</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">theTemplate</span><span class="p">);</span>
<span class="c1">// "This is the result of the computation: 8"</span>

<span class="c1">// ES5 version</span>
<span class="kd">var</span> <span class="nx">someComputedValue</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">+</span> <span class="mi">3</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">theTemplate</span> <span class="o">=</span> <span class="s1">'This is the result of the computation: '</span> <span class="o">+</span> <span class="nx">someComputedValue</span><span class="p">;</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">theTemplate</span><span class="p">);</span>
<span class="c1">// "This is the result of the computation: 8"</span></code></pre></figure>

<p>You can probably see some good use-cases for template literals, one of them 
being DOM templates. If you’d like 
more info on the topic, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals">this page on the Mozilla Developer Network</a> 
sums it up pretty well.</p>

<p>Given that we already have our serialized version of the <code class="highlighter-rouge">person</code> object, along 
with its <code class="highlighter-rouge">sayHi</code> method, let’s now try to convert the body of the method back to 
executable code.<br />
For this matter, we’re going to have to resort to the “evil” <code class="highlighter-rouge">eval</code> and before 
using something that so many people labelled as evil, let’s see what it does, 
so we are conscious about the risks we’re taking.</p>

<p>In a nutshell, <code class="highlighter-rouge">eval</code> takes strings and treats them as executable code. One of 
the biggest risks you’re exposing yourself and your application to would be 
<a href="https://www.owasp.org/index.php/Code_Injection">code injection</a>. If you end up 
serializing user-inserted data, be sure to thoroughly validate their input and 
as a rule of thumb, don’t run code inserted by your user, unless you’re building 
the next <a href="https://jsbin.com">jsbin.com</a> or the next <a href="https://codepen.io">codepen.io</a></p>

<p>With the knowledge we have about <code class="highlighter-rouge">eval</code> and template strings, we can now 
build our <code class="highlighter-rouge">reviver</code> function as follows:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">let</span> <span class="nx">reviver</span> <span class="o">=</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">key</span> <span class="o">===</span> <span class="s1">'string'</span> <span class="o">&amp;&amp;</span> <span class="nx">key</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">'function '</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">functionTemplate</span> <span class="o">=</span> <span class="err">`</span><span class="p">(</span><span class="nx">$</span><span class="p">{</span><span class="nx">value</span><span class="p">})</span><span class="err">`</span><span class="p">;</span>
    <span class="k">return</span> <span class="nb">eval</span><span class="p">(</span><span class="nx">functionTemplate</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<p>The code is pretty self-explanatory, but for extra clarity, we’re building a new 
template for all the items in the string we’re parsing, that contain the 
‘function’ keyword followed by a space, at the very beginning and then we’re 
evaluating the resulting expression and returning it to <code class="highlighter-rouge">JSON.parse</code> in order to 
be added to the final object.<br />
The final version of the code would look like the snippet below:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="s1">'use strict'</span><span class="p">;</span>

<span class="c1">// serialize.js</span>

<span class="kd">let</span> <span class="nx">person</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">name</span><span class="p">:</span> <span class="s1">'Susan'</span><span class="p">,</span>
  <span class="na">age</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span>
  <span class="na">sayHi</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Susan says hi!'</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="kd">let</span> <span class="nx">replacer</span> <span class="o">=</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// if we get a function, give us the code for that function</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">value</span> <span class="o">===</span> <span class="s1">'function'</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">value</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// get a stringified version of our object, and indent the keys at 2 spaces</span>
<span class="kr">const</span> <span class="nx">serialized</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">person</span><span class="p">,</span> <span class="nx">replacer</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">serialized</span><span class="p">);</span> 
<span class="c1">// {"name":"Susan","age":24,"sayHi":"function () {\n\tconsole.log('Susan says hi!');\n  }"}</span>


<span class="c1">// de_serialize.js</span>
<span class="kd">let</span> <span class="nx">reviver</span> <span class="o">=</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">value</span> <span class="o">===</span> <span class="s1">'string'</span> <span class="o">&amp;&amp;</span> <span class="nx">value</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">'function '</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">functionTemplate</span> <span class="o">=</span> <span class="err">`</span><span class="p">(</span><span class="nx">$</span><span class="p">{</span><span class="nx">value</span><span class="p">})</span><span class="err">`</span><span class="p">;</span>
    <span class="k">return</span> <span class="nb">eval</span><span class="p">(</span><span class="nx">functionTemplate</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">parsedObject</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">serialized</span><span class="p">,</span> <span class="nx">reviver</span><span class="p">);</span>

<span class="nx">parsedObject</span><span class="p">.</span><span class="nx">sayHi</span><span class="p">();</span> <span class="c1">// Susan says hi!</span></code></pre></figure>

<p>The reason that we wrap the function in parentheses is that we need to force 
the vm to evaluate the function in an expression context, and our function 
needs to be a function expression as it is missing its name. We are only operating 
with <code class="highlighter-rouge">eval</code> on the value of the <code class="highlighter-rouge">sayHi</code> key, which is an unnamed function. If 
you’d like more info about this limitation of <code class="highlighter-rouge">eval</code> take a look at 
<a href="http://stackoverflow.com/a/9076377/2423398">this answer on StackOverflow</a>.<br />
As you can see, the newly resulted object has the <code class="highlighter-rouge">sayHi</code> method available and 
ready for use and executing the method prints the same message as <code class="highlighter-rouge">person.sayHi</code>.</p>

<p>Another issue I ommitted to mention about <code class="highlighter-rouge">eval</code> is that it is pretty slow, 
because it has to invoke the VM in order to evaluate the code, 
unlike the built-in <code class="highlighter-rouge">Function</code> constructor, which is highly optimised in newer 
versions of JavaScript engines.
If performance is something that is critical for you, there’s an option to use 
the <code class="highlighter-rouge">Function</code> constructor instead of <code class="highlighter-rouge">eval</code> in your <code class="highlighter-rouge">reviver</code> function like 
in the snippet below:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">let</span> <span class="nx">reviver</span> <span class="o">=</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">value</span> <span class="o">===</span> <span class="s1">'string'</span> <span class="o">&amp;&amp;</span> <span class="nx">value</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">'function '</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">functionTemplate</span> <span class="o">=</span> <span class="err">`</span><span class="p">(</span><span class="nx">$</span><span class="p">{</span><span class="nx">value</span><span class="p">}).</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">)</span><span class="err">`</span><span class="p">;</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nb">Function</span><span class="p">(</span><span class="nx">functionTemplate</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<p>Even though it is said that the <code class="highlighter-rouge">Function</code> constructor is faster than <code class="highlighter-rouge">eval</code>, 
be cautious that in this case, you have to create 2 functions in-memory —
the outer IIFE that gets auto-executed and returns the method we want.<br />
You also need to use <code class="highlighter-rouge">Function.prototype.call</code> in order to keep <code class="highlighter-rouge">this</code> 
relative to the current object, and not to the window/global object.</p>

<p>Ultimately, it all comes down to personal preference so whether you use <code class="highlighter-rouge">eval</code> 
or another method it is all up to you, the important thing is to use what 
makes the most sense for you and gets the job done in an elegant manner.</p>

<h2 id="reference">Reference</h2>

<ul>
  <li><a href="http://json.org/">JSON.org</a></li>
  <li><a href="http://stackoverflow.com/a/9076377/2423398">JavaScript eval() “syntax error” on parsing a function string</a></li>
  <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON">JSON</a></li>
  <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/eval">Eval</a></li>
</ul>

<blockquote>
  <p>Photo credits:<br />
<a href="https://www.flickr.com/photos/sdelgado">Sergio Delgado</a> — <a href="https://en.wikipedia.org/wiki/Sloth">Three-toed sloth in the Dallas World Aquarium</a></p>
</blockquote>

  </main>

  <footer class="article-footer">
    <section>
	<h3>Spread the word</h3>
	<span class='st_facebook_large' displayText='Facebook'></span>
	<span class='st_twitter_large' displayText='Tweet'></span>
	<span class='st_linkedin_large' displayText='LinkedIn'></span>
	<span class='st_email_large' displayText='Email'></span>
	<span class='st_reddit_large' displayText='Reddit'></span>
	<span class='st_googleplus_large' displayText='Google +'></span>
	<span class='st_pinterest_large' displayText='Pinterest'></span>
</section>
    <div class="pagination" role="navigation">
  
  <a href="/becoming-a-better-javascript-developer/" title="Previous article: Serializing object methods using ES6 template strings and eval" role="prev">&larr; Becoming a better JavaScript developer</a>
  
  
</div>

    <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'codesinz'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  </footer>
</article>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-32468134-4', 'auto');
  ga('require', 'displayfeatures');
  ga('send', 'pageview');
</script>

  <!-- Drip -->
<script type="text/javascript">
  var _dcq = _dcq || [];
  var _dcs = _dcs || {}; 
  _dcs.account = '9282313';
  
  (function() {
    var dc = document.createElement('script');
    dc.type = 'text/javascript'; dc.async = true; 
    dc.src = '//tag.getdrip.com/9282313.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(dc, s);
  })();
</script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad();
  </script>
  <script type="text/javascript">var switchTo5x=true;</script>
  <script type="text/javascript" src="//ws.sharethis.com/button/buttons.js"></script>
  <script type="text/javascript">stLight.options({publisher: "92204b4b-884e-4a7f-9337-a39d86c8b368", doNotHash: true, doNotCopy: false, hashAddressBar: true, shorten: false});</script>
</body>
</html>

