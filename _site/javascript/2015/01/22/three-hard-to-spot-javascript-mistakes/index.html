<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/Blog">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  
    <title>Three hard to spot JavaScript mistakes</title>
  

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="keywords" content="programming, blog, tutorials, technical, javascript">

  <meta name="author" itemprop="creator" content="Adrian Oprea">

  <meta property="og:locale" content="en_US" />


  
    <meta name="description" itemprop="description" content="Working on a handful of big ecommerce projects for the past couple of years, I often found myself in a situation where one component, or the whole application my team was working on, was working properly in all scenarios. All except one...
">

    <meta property="og:type" content="article" />
    <meta property="og:title" content="Three hard to spot JavaScript mistakes" />
    <meta property="og:description" content="Working on a handful of big ecommerce projects for the past couple of years, I often found myself in a situation where one component, or the whole application my team was working on, was working properly in all scenarios. All except one...
" />
    <meta property="og:image" content="http://codesi.nz/images/posts/mistakes.jpg" />
    <meta property="og:url" content="http://codesi.nz/javascript/2015/01/22/three-hard-to-spot-javascript-mistakes/" />
    <meta property="article:published_time" content="22 Jan 2015" />
    <meta property="article:modified_time" content="22 Jan 2015 " />
    <link rel="canonical" href="http://codesi.nz/javascript/2015/01/22/three-hard-to-spot-javascript-mistakes/">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="Working on a handful of big ecommerce projects for the past couple of years, I often found myself in a situation where one component, or the whole application my team was working on, was working properly in all scenarios. All except one...
">
    <meta name="twitter:url" content="http://codesi.nz/javascript/2015/01/22/three-hard-to-spot-javascript-mistakes/
    ">
    <meta name="twitter:title" content="Three hard to spot JavaScript mistakes">
    <meta name="twitter:description" content="Working on a handful of big ecommerce projects for the past couple of years, I often found myself in a situation where one component, or the whole application my team was working on, was working properly in all scenarios. All except one...
">
    <meta name="twitter:image" content="http://codesi.nz/images/posts/mistakes.jpg">


  
    <meta name="”twitter:creator”" value="@opreaadrian">

  
    <link rel="author" href="https://plus.google.com/+AdrianOpreasWeb/">
    <link rel="publisher" href="https://plus.google.com/+AdrianOpreasWeb/">
  


  <!-- syntax highlighting CSS -->
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/tomorrow.min.css">

  <!-- CSS -->
  <link rel="stylesheet" href="/css/reset.css">
  <link rel="stylesheet" href="/css/main.css">
  <link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">

  <!-- Fonts -->
  <link href='http://fonts.googleapis.com/css?family=Bitter:400,700,400italic|Open+Sans:400italic,600italic,400,600|Source+Code+Pro' rel='stylesheet' type='text/css'>

</head>
<body>
  <header style="background-image: url(/images/posts/mistakes.jpg);">
  <div class="container post-container">
    <a href="/" class="home_button"></a>
    <div class="inner-container">
      <h1>Three hard to spot JavaScript mistakes</h1>
      <ul class="meta">
        <li>
          <span>
            Author
          </span>
          <a class="post-author" href="https://twitter.com/@opreaadrian">Adrian Oprea</a>
        </li>
        <li>
          <span>
            Published
          </span>
          22 Jan 2015
        </li>
        <li>
          <span>
            Category
          </span>
          javascript
        </li>
      </ul>
    </div>
    <ul class="pagination">
      
        <li class="previous">
          <a href="/nodejs/2015/01/17/npm-package-automation-with-packo/">
            Previous
          </a>
        </li>
      
      
      <li class="next">
        <a href="/nodejs/2015/01/28/working-with-javascript-promises/">
          Next
        </a>
      </li>
      
    </ul>
  </div>
</header>

<article itemscope itemtype="http://schema.org/BlogPosting">
<meta itemprop="datePublished" content="2015-01-22T00:00:00+02:00">
<meta itemprop="dateModified" content="2015-01-22T00:00:00+02:00">
<meta itemprop="keywords" content="javascript, validation, mistakes, beginner, code, programming, objects, indexOf, for-in, loops">
  <section itemprop="articleBody" class="container">
    <p>Working on a handful of big ecommerce projects for the past couple of years, I often found myself in a situation where one component, or the whole application my team was working on, was working properly in all scenarios. All except one...</p>

<p>Most of the times, we thought that we had backend issues, that data wasn&#39;t consistent, that God didn&#39;t love us that day. We thought so hard that we didn&#39;t know what to think. Some of us were using debuggers, but the third time the application failed and the debugger said nothing about it, and there was no console error, nothing, we would fill up the code with <code>console.log</code>s. When none of this would work, we would simply relax, as this was something divine, something that us mortals would never understand.<br>
The next morning, I would go back to work, after a good night sleep(4-5 hours) and while sipping on some coffee, I would take one last look at the divine piece of code, and after 5 seconds, the first WTF would suddenly find its way into the office.<br>
The aforementioned story, has an open end, and you can choose your version from the 3 options below. Enjoy!</p>

<h2>indexOf()</h2>

<blockquote>
<p><code>Array.indexOf()</code> and <code>String.indexOf()</code></p>
</blockquote>

<p>In order to find if a certain substring exists within a given string, or if a certain key exists within a given array, the go-to method is <code>indexOf()</code>.</p>

<p>Let&#39;s say that we have the following setup:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js">    <span class="kd">var</span> <span class="nx">myString</span> <span class="o">=</span> <span class="s1">'The quick brown fox jumps over the lazy developer\'s head'</span><span class="p">;</span>
</code></pre></div>
<p>Calling <code>myString.indexOf(&#39;developer&#39;);</code> would give us the index at which the word/substring &quot;developer&quot; is found within the given string, in our case <code>40</code>.</p>

<p>Let&#39;s say that we have a function that checks whether a certain word is present within a given sentence, and returns true or false based on this verification. Our code would look something like this:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js">    <span class="kd">function</span> <span class="nx">checkWordOccurrenceInSentence</span><span class="p">(</span><span class="nx">word</span><span class="p">,</span> <span class="nx">sentence</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">word</span> <span class="o">||</span> <span class="o">!</span><span class="nx">sentence</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">'Please provide both parameters.'</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">sentence</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">word</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">myString</span> <span class="o">=</span> <span class="s1">'The quick brown fox jumps over the lazy developer\'s head'</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">checkWordOccurrenceInSentence</span><span class="p">(</span><span class="s1">'programmer'</span><span class="p">,</span> <span class="nx">myString</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Found programmer'</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Programmer not found'</span><span class="p">);</span>
    <span class="p">}</span>
</code></pre></div>
<p>You would think that the piece of code above will say &quot;Programmer not found&quot; but you are wrong. As you might already know, the falsy values in JavaScript(values that evaluate to false) are 5: <code>NaN</code>, <code>Null</code>, <code>undefined</code>, <code>0</code> and <code>&#39;&#39;</code>. Nowhere does it say that <code>-1</code>, the value that <code>indexOf()</code> returns if it does not find anything, will evaluate to false. </p>

<p>So basically what happens when you say <code>if (checkWordOccurrenceInSentence(&#39;programmer&#39;, myString))</code>
is that <code>indexOf()</code> will return <code>-1</code> inside <code>checkWordOccurrenceInSentence()</code> and that will be evaluated as <code>true</code> and this will be propagated and evaluated in your <code>if</code> statement.</p>

<p>A better way to do this is to refactor your function to look like the one below:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js">    <span class="kd">function</span> <span class="nx">checkWordOccurrenceInSentence</span><span class="p">(</span><span class="nx">word</span><span class="p">,</span> <span class="nx">sentence</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">word</span> <span class="o">||</span> <span class="o">!</span><span class="nx">sentence</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">'Please provide both parameters.'</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// Using "!=" instead of "!=="(identity operator) as indexOf() will not trick us</span>
        <span class="c1">// You can use &gt;= 0 instead of != -1</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">sentence</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">word</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div>
<h2>Checking object properties</h2>

<blockquote>
<p>Object.property/Object[&#39;key&#39;]</p>
</blockquote>

<p>Let&#39;s assume that you get a JSON object from an API, that returns error data from an error aggregator based on a certain query, and displays only certain errors. You will obviously need to validate if the error key exists, and display it&#39;s value.</p>

<p>Let&#39;s take the following JSON object as an example of error data, and check whether the <code>fatalErrorsCount</code> property exists as we would only want to show the fatal errors.</p>
<div class="highlight"><pre><code class="language-js" data-lang="js">    <span class="c1">// /errors/startDateMiliseconds/endDateMiliseconds</span>
    <span class="kd">var</span> <span class="nx">errorData</span> <span class="o">=</span> <span class="nx">$http</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'https://api.company.com/errors/14201436816409/1421882120458'</span><span class="p">);</span>
    <span class="p">[</span><span class="nx">table</span> <span class="nx">creation</span> <span class="nx">code</span> <span class="nx">goes</span> <span class="nx">here</span><span class="p">...]</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">errorData</span><span class="p">.</span><span class="nx">fatalErrorsCount</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">ui</span><span class="p">.</span><span class="nx">components</span><span class="p">.</span><span class="nx">show</span><span class="p">(</span><span class="s1">'fatal-errors-count'</span><span class="p">,</span> <span class="nx">errorData</span><span class="p">.</span><span class="nx">fatalErrorsCount</span><span class="p">);</span>
    <span class="p">}</span>
</code></pre></div>
<p>Again, like with <code>indexOf</code>, you would think that this works fine: you get data, you check if the key exists, and BAM!, you output those damn fatal errors. Not so fast!<br>
What if there are no fatal errors for that period, so <code>errorData.fatalErrorsCount</code> is 0. Well, then our <code>if</code> statement there doesn&#39;t look so good, does it? This also happens if <code>fatalErrorsCount</code> is set to any falsy value, so a better way to do this would be to use the <code>in</code> operator as follows:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js">    <span class="p">[...]</span>
    <span class="k">if</span> <span class="p">(</span><span class="s1">'fatalErrorsCount'</span> <span class="k">in</span> <span class="nx">errorData</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">ui</span><span class="p">.</span><span class="nx">components</span><span class="p">.</span><span class="nx">show</span><span class="p">(</span><span class="s1">'fatal-errors-count'</span><span class="p">,</span> <span class="nx">errorData</span><span class="p">.</span><span class="nx">fatalErrorsCount</span><span class="p">);</span>
    <span class="p">}</span>
</code></pre></div>
<p>and now you are safe!</p>

<p>EDIT 2015/03/08: As per <a href="https://twitter.com/jacobparker/status/568519846050205696">@jakobparker&#39;s tweet</a> I promised I&#39;ll make an edit and put the information here, so here it goes.<br>
Use the <code>in</code> operator with caution, as it triggers prototype lookups, and you might get the property that you&#39;re looking for, from another object, further up the prototype chain.</p>

<p>Let&#39;s say you have the following structure:</p>
<div class="highlight"><pre><code class="language-" data-lang="">+ Object
  - toString()
    |
    + Parent
        + Child
</code></pre></div>
<p>If you do this: <code>var childHasTostringMethod = &#39;toString&#39; in Child;</code> you will see that your variable will be set to <code>true</code> as this will trigger a prototype lookup, that in plain english looks like this: </p>

<p>&mdash; <code>Child</code> do you have a <code>toString</code> property?<br>
&mdash; No, I don&#39;t!<br>
&mdash; Okay, I&#39;ll ask your father. [.. walks up the <code>prototype</code>, to ask the <code>Child</code>&#39;s <code>Parent</code>.]<br>
&mdash; <code>Parent</code> do you have a <code>toString</code> property?<br>
&mdash; No, I don&#39;t!<br>
&mdash; Okay, then I guess your parent should have it, otherwise I&#39;ll tell the people who told me to ask you, that it&#39;s <code>undefined</code>.<br>
- <code>Object</code> do you have a <code>toString</code> property?<br>
- Yes I do, here it is!<br>
[FIN]</p>

<p>Bottom line is that if you want to restrict your lookup to the current object and stay safe from prototype lookups, you should use the <code>hasOwnProperty()</code> method, to check if the key you&#39;re looking for is available on your object.</p>

<h2><code>for...in</code> on Array(s)</h2>

<p>I&#39;ll just tell you from the start that this is an EFFIN&#39; bad idea. First of all because in JavaScript it is perfectly okay to have an array like this:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js">    <span class="kd">var</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="nx">arr</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">11</span><span class="p">;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">arr</span><span class="p">);</span> <span class="c1">//[ , , , 11 ]</span>

    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">el</span> <span class="k">in</span> <span class="nx">arr</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span> <span class="c1">// will log 3</span>
    <span class="p">}</span>
</code></pre></div>
<p>This means that if we perform a <code>for</code> loop on our array and log out each element would get 3xundefined and then 11.<br>
But when performing a <code>for-in</code> loop, we get the index of the last element, as the statement treats our array as an object, treating the index <code>3</code> as the key, and 11 as the value because in JavaScript it is perfectly legal to have an object looking like this:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js">    <span class="kd">var</span> <span class="nx">object</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">'0'</span> <span class="p">:</span> <span class="s1">'First value'</span><span class="p">,</span>
        <span class="s1">'1'</span> <span class="p">:</span> <span class="s1">'Second value'</span>
    <span class="p">};</span>
</code></pre></div>
<p>I think it is also worth mentioning <a href="http://vimeo.com/12529436#t=272">Paul Irish&#39;s asshole effect</a> as somebody could do something like this:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js">    <span class="c1">// in another js file</span>
    <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">assholeVar</span> <span class="o">=</span> <span class="s1">'I haz a dude'</span><span class="p">;</span> <span class="c1">// http://lolcode.org/</span>

    <span class="c1">// in your module</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">el</span> <span class="k">in</span> <span class="nx">arr</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span> <span class="c1">// will log "3" and "assholeVar" for all arrays</span>
    <span class="p">}</span>
</code></pre></div>
<p>Key takeaway here, is <strong>NEVER USE <code>for...in</code> ON ARRAYS</strong>. Use <code>for</code>, <code>while</code>, <code>do...while</code>, <code>forEach</code> and the list goes on.</p>

<p>I hope the info that I shared here is valuable to developers, especially beginners, and if you know any other &quot;little&quot; mistakes like the ones outlined in this article, please feel free to share them in the comments section, and I might even update the post publish them, for the sake of posterity. </p>

<p>P.S. I had one more, about <code>i++</code> but I&#39;ll publish that one in an update to this post.</p>

<blockquote>
<p>Image credits: <a href="https://flic.kr/p/nrHJrx">Some mistake, surely ...</a> by <a href="https://www.flickr.com/photos/atoach/">Tim Green</a></p>
</blockquote>


  <section>
    <h3>Share this article:</h3>
    <span class='st_facebook_large' displayText='Facebook'></span>
    <span class='st_twitter_large' displayText='Tweet'></span>
    <span class='st_linkedin_large' displayText='LinkedIn'></span>
    <span class='st_email_large' displayText='Email'></span>
    <span class='st_reddit_large' displayText='Reddit'></span>
    <span class='st_googleplus_large' displayText='Google +'></span>
    <span class='st_pinterest_large' displayText='Pinterest'></span>      
  </section>
      <div id="disqus_thread"></div>
      <script type="text/javascript">
          /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
          var disqus_shortname = 'codesinz'; // required: replace example with your forum shortname

          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
      </script>
      <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </section>
</article>




  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-32468134-4', 'auto');
  ga('require', 'displayfeatures');
  ga('send', 'pageview');

</script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
<script>
  hljs.initHighlightingOnLoad();
</script>
<script type="text/javascript">var switchTo5x=true;</script>
<script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
<script type="text/javascript">stLight.options({publisher: "92204b4b-884e-4a7f-9337-a39d86c8b368", doNotHash: false, doNotCopy: false, hashAddressBar: true});</script>
</body>
</html>
