<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/Blog">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  
    <title>Working with JavaScript promises: practices and mistakes</title>
  

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="keywords" content="programming, tutorials, javascript, html, css, frontend, nodejs, react, angular">

  <meta name="author" itemprop="creator" content="Adrian Oprea">

  <meta property="og:locale" content="en_US" />


  
    <meta name="description" itemprop="description" content="We use promises in our day to day grind, and not few were the occasions in which I found promise-using code improperly structured, responses handled in an inconsistent manner, as well as weak or no error handling.
With this post I aim to share some of my practices when it comes to working with promises. Throughout the post I will use ES6 syntax, but the principles outlined are available whether you&#39;re using native JavaScript promises, or a library that implements the Promises A+ spec.
">

    <meta property="og:type" content="article" />
    <meta property="og:title" content="Working with JavaScript promises: practices and mistakes" />
    <meta property="og:description" content="We use promises in our day to day grind, and not few were the occasions in which I found promise-using code improperly structured, responses handled in an inconsistent manner, as well as weak or no error handling.
With this post I aim to share some of my practices when it comes to working with promises. Throughout the post I will use ES6 syntax, but the principles outlined are available whether you&#39;re using native JavaScript promises, or a library that implements the Promises A+ spec.
" />
    <meta property="og:image" content="http://codesi.nz/images/posts/promises.jpg" />
    <meta property="og:url" content="http://codesi.nz/working-with-javascript-promises/" />
    <meta property="article:published_time" content="28 Jan 2015" />
    <meta property="article:modified_time" content="28 Jan 2015 " />
    <link rel="canonical" href="http://codesi.nz/working-with-javascript-promises/">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="We use promises in our day to day grind, and not few were the occasions in which I found promise-using code improperly structured, responses handled in an inconsistent manner, as well as weak or no error handling.
With this post I aim to share some of my practices when it comes to working with promises. Throughout the post I will use ES6 syntax, but the principles outlined are available whether you&#39;re using native JavaScript promises, or a library that implements the Promises A+ spec.
">
    <meta name="twitter:url" content="http://codesi.nz/working-with-javascript-promises/
    ">
    <meta name="twitter:title" content="Working with JavaScript promises: practices and mistakes">
    <meta name="twitter:description" content="We use promises in our day to day grind, and not few were the occasions in which I found promise-using code improperly structured, responses handled in an inconsistent manner, as well as weak or no error handling.
With this post I aim to share some of my practices when it comes to working with promises. Throughout the post I will use ES6 syntax, but the principles outlined are available whether you&#39;re using native JavaScript promises, or a library that implements the Promises A+ spec.
">
    <meta name="twitter:image" content="http://codesi.nz/images/posts/promises.jpg">


  
    <meta name="”twitter:creator”" value="@opreaadrian">

  
    <link rel="author" href="https://plus.google.com/+AdrianOpreasWeb/">
    <link rel="publisher" href="https://plus.google.com/+AdrianOpreasWeb/">
  


  <!-- syntax highlighting CSS -->
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/tomorrow.min.css">

  <!-- CSS -->
  <link rel="stylesheet" href="/css/reset.css">
  <link rel="stylesheet" href="/css/main.css">
  <link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">

  <!-- Fonts -->
  <link href='http://fonts.googleapis.com/css?family=Bitter:400,700,400italic|Open+Sans:400italic,600italic,400,600|Source+Code+Pro' rel='stylesheet' type='text/css'>

</head>
<body>
  <header style="background-image: url(/images/posts/promises.jpg);">
  <div class="container post-container">
    <a href="/" class="home_button"></a>
    <div class="inner-container">
      <h1>Working with JavaScript promises: practices and mistakes</h1>
      <ul class="meta">
        <li>
          <span>
            Author
          </span>
          <a class="post-author" href="https://twitter.com/@opreaadrian">Adrian Oprea</a>
        </li>
        <li>
          <span>
            Published
          </span>
          28 Jan 2015
        </li>
        <li>
          <span>
            Category
          </span>
          nodejs
        </li>
      </ul>
    </div>
    <ul class="pagination">
      
        <li class="previous">
          <a href="/three-hard-to-spot-javascript-mistakes/">
            Previous
          </a>
        </li>
      
      
      <li class="next">
        <a href="/working-with-javascript-promises-handling-the-unexpected/">
          Next
        </a>
      </li>
      
    </ul>
  </div>
</header>

<article itemscope itemtype="http://schema.org/BlogPosting">
<meta itemprop="datePublished" content="2015-01-28T08:00:00+02:00">
<meta itemprop="dateModified" content="2015-01-28T22:00:00+02:00">
<meta itemprop="keywords" content="nodejs, workflow, javascript, promises, async">
  <section itemprop="articleBody" class="container">
    <p>We use <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">promises</a> in our day to day grind, and not few were the occasions in which I found promise-using code improperly structured, responses handled in an inconsistent manner, as well as weak or no error handling.<br>
With this post I aim to share some of my practices when it comes to working with promises. Throughout the post I will use ES6 syntax, but the principles outlined are available whether you&#39;re using native JavaScript promises, or a library that implements the <a href="https://promisesaplus.com/">Promises A+ spec</a>.</p>

<h2>Introduction</h2>

<blockquote>
<p>What &quot;is&quot; promises?</p>
</blockquote>

<p>&quot;A promise represents the eventual result of an asynchronous operation. The primary way of interacting with a promise is through its <code>then</code> method, which registers callbacks to receive either a promise’s eventual value or the reason why the promise cannot be fulfilled.&quot; &mdash; <a href="https://promisesaplus.com/">Promises A+ official spec</a></p>

<p>In short, a promise object represents a wrapper around that asynchronous operation(which I sometimes call &quot;task&quot;), that at some point might be &quot;resolved&quot; or &quot;rejected&quot; based on whatever the completion of the operation returns. Upon resolution/rejection, the appropriate callback for the promise&#39;s resolution state, registered by the <code>then</code> method, will be called with the data/rejection reason.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// app.js</span>

<span class="c1">// Classic usage of Promises (promise w/ resolver)</span>
<span class="kd">var</span> <span class="nx">getData</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Promise</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">DataService</span><span class="p">.</span><span class="nx">getCustomerDetails</span><span class="p">(</span><span class="s1">'11AFFDDDS'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">details</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">error</span> <span class="o">&amp;&amp;</span> <span class="nx">details</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">resolve</span><span class="p">(</span><span class="nx">details</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">reject</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">});</span>

<span class="cm">/* getData is a wrapper around the "task" 
   that pulls the customer details from the backend */</span>
<span class="nx">getData</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// This is the success callback</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// This is the error callback</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<p>Besides the previous pattern, which allows you to USE asynchronous tasks, the most common usage I find with promises is by using deferred objects, that allow you to IMPLEMENT async tasks. In this direction, we can take the example of our <code>getCustomerDetails</code> method from the DataService.<br>
In order to implement the method to act as a promise, we need our code to look like below:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// dataservice.js</span>

<span class="kd">var</span> <span class="nx">db</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'./data/dbhandler'</span><span class="p">),</span>
    <span class="nx">QUERY_FAILED</span> <span class="o">=</span> <span class="s2">"Database query failed."</span><span class="p">;</span>

<span class="c1">// [...db configuration]</span>

<span class="nx">db</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">config</span><span class="p">);</span>

<span class="nx">DataService</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getCustomerDetails</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">customerID</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Create a deferred object that we'll use to control the execution flow</span>
    <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">Promise</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>

    <span class="nx">db</span><span class="p">.</span><span class="nx">getCustomer</span><span class="p">(</span><span class="nx">customerID</span><span class="p">,</span> <span class="p">{</span>
        <span class="na">success</span> <span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// We're done, query succeeded -- doesn't mean we have data</span>
            <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="na">error</span>   <span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Something went wrong with the db. Worth investigating</span>
            <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">({</span>
                <span class="na">message</span> <span class="p">:</span> <span class="nx">QUERY_FAILED</span><span class="p">,</span>
                <span class="na">error</span>   <span class="p">:</span> <span class="nx">error</span> 
            <span class="p">})</span>
        <span class="p">}</span>  
    <span class="p">});</span>

    <span class="c1">// Return this so we can do DataService.getCustomerDetails().then(...)</span>
    <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>Now, istead of working with promises at our application level, we&#39;re moving all the logic related to the DataService in its own, <code>DataService</code> module, so our application code now looks like this:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// app.js</span>

<span class="nx">DataService</span>
    <span class="p">.</span><span class="nx">getCustomerDetails</span><span class="p">(</span><span class="s1">'11AFFDDDS'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// do something with data</span>
        <span class="p">}</span>
    <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// perform proper error handling</span>
    <span class="p">});</span>
</code></pre></div>
<h2>Proper naming</h2>

<blockquote>
<p>If you can count it, give it a noun for a name!</p>
</blockquote>

<p>One of the things that confuse me when I bump into code that uses promises is the naming. </p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// badly named variable -- we have a DEFERRED object, not a defer action.</span>
<span class="kd">var</span> <span class="nx">defer</span> <span class="o">=</span> <span class="nx">Promise</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>

<span class="c1">// Much better</span>
<span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">Promise</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>
</code></pre></div>
<p>I&#39;m really into clean, self-explanatory code so snippets like the one above turn my &quot;you-re-not-respecting-the-styleguide&quot; alarm on.</p>

<h2>Working with multiple promises</h2>

<blockquote>
<p>Do you just <code>deferred.resolve(data);</code>? Then why write it 100 times?</p>
</blockquote>

<p>Let&#39;s say that you use the <code>DataService.getCustomerDetails</code> method, along with a <code>Cart.getCartItems()</code> method pull in the necessary information for an order.<br>
After receiving the info, you need to set the data as properties on the <code>Order</code> instance. If all you&#39;re doing is <code>this.property = returnedData</code>, instead of writing 2 separate calls, you can use <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/all"><code>Promise.all()</code></a>, and use its <code>success</code>/<code>rejection</code> callbacks instead of having individual callbacks for each promise.<br>
This way, if you would have to add a third promise, and set whatever data it returns on the current order, you only need to write 2 lines of code, instead of approx. 6 lines. I&#39;m suggesting the following structure, that promotes code reuse.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Note that this will not work currently as support for native Promises in </span>
<span class="c1">// es6-enabling module loaders/runtimes is not that stable</span>
<span class="kr">import</span> <span class="nx">DataService</span> <span class="nx">from</span> <span class="s1">'./dataservice.js'</span>
<span class="kr">import</span> <span class="nx">Cart</span> <span class="nx">from</span> <span class="s1">'./cart.js'</span>

<span class="kr">class</span> <span class="nx">Order</span> <span class="p">{</span>
    <span class="nx">constructor</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">([</span>
            <span class="nx">DataService</span><span class="p">.</span><span class="nx">getCustomerDetails</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">userID</span><span class="p">),</span>
            <span class="nx">Cart</span><span class="p">.</span><span class="nx">getCartItems</span><span class="p">()</span>
        <span class="p">]).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">customer</span> <span class="o">=</span> <span class="nx">data</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">cartData</span> <span class="o">=</span> <span class="nx">data</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
        <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2><code>IF error THEN reject</code></h2>

<p>Just don&#39;t do this:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">someAsyncTask</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">Promise</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>

    <span class="nx">ExternalService</span><span class="p">.</span><span class="nx">getData</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'An error has occurred!'</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>Add a case for rejection and always add use the rejection callback when using promises. Make sure you also add meaningful messaging, especially when dealing with errors/rejections.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">someAsyncTask</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">Promise</span><span class="p">.</span><span class="nx">defer</span><span class="p">();</span>

    <span class="nx">DataService</span><span class="p">.</span><span class="nx">getData</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">({</span>
                <span class="na">message</span> <span class="p">:</span> <span class="s1">'Query to the dataservice failed.'</span><span class="p">,</span>
                <span class="na">error</span>   <span class="p">:</span> <span class="nx">err</span>
            <span class="p">});</span>

            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h2>Don&#39;t <code>resolve</code> when you should <code>reject</code></h2>

<p>You might find yourself in a situation where you&#39;re calling an external API, and if that call fails for some reason, you would still like to return some data from the promise, instead of rejecting it and probably making the rest of your code fail. In that situation you probably think the right thing to do is to choose a solution like the one below.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">getOrderDetails</span><span class="p">(</span><span class="nx">orderID</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="nx">Promise</span><span class="p">.</span><span class="nx">defer</span><span class="p">(),</span>
        <span class="nx">defaults</span> <span class="o">=</span> <span class="p">{</span>
            <span class="na">orderID</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="na">items</span>   <span class="p">:</span> <span class="p">[],</span>
            <span class="na">amount</span>   <span class="p">:</span> <span class="mi">0</span>
        <span class="p">};</span>

    <span class="nx">Order</span><span class="p">.</span><span class="nx">getDetails</span><span class="p">(</span><span class="nx">orderID</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">data</span><span class="p">){</span> 
        <span class="c1">// If the getDetails API endpoint fails, then just send some default data</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">error</span> <span class="o">&amp;&amp;</span> <span class="nx">error</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">==</span> <span class="mi">500</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">defaults</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">promise</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// The call looks like this</span>
<span class="nx">getOrderDetails</span><span class="p">(</span><span class="s1">'ABC123'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// do something with data</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// error handling</span>
        <span class="p">}</span>
    <span class="p">})</span>
</code></pre></div>
<p>The problem with the code above is that only you know how to call the getOrderDetails function. If another developer has to work with your code 3 months from now, he will probably write the <code>getOrderDetails</code> call using both success and rejection callbacks, and will probably spend some time figuring out why somewhere along the road his order <code>amount</code> is set to 0. Bottom line, please use resolve/reject thoroughly, as reject doesn&#39;t necessarily mean CRASH THE PROCESS, or BLOW UP THE APPLICATION. It&#39;s just a way of saying that something failed and you should take an action.</p>

<h2>Short-cirtuit ? Use <code>return</code>.</h2>

<p>If by any chance you have to implement a method that takes a deferred as an argument and resolves/rejects it based on data resulting from further processing, you have to rely on <code>if-else</code>  statements.<br>
In this situation, if you&#39;re planning to short-circuit the logic, note that <code>deferred.resolve()</code> and <code>deferred.reject()</code> don&#39;t return the control to the caller, so always use <code>return</code> after you resolve/reject(depends on your situation) the promise, as without it, the code will continue to run.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">processData</span><span class="p">(</span><span class="nx">deferred</span><span class="p">,</span> <span class="nx">input</span><span class="p">)</span>
    <span class="nx">somePromiseBasedTask</span><span class="p">(</span><span class="nx">input</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">deferred</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span> <span class="c1">// USE it or the logic will continue to execute below    </span>
        <span class="p">}</span>

        <span class="nx">deferred</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>

    <span class="p">});</span>
<span class="p">}</span>
</code></pre></div>
<p>In the previous code block, if an error occurs and no <code>return</code> exists, you will be rejecting the promise as <code>err == true</code> and then try to resolve it, as the logic will exit the <code>if</code> statement and move further to the <code>deferred.resolve()</code> statement, which will result in an error.</p>

<h2>Libraries</h2>

<p>Last but not least, I&#39;ll share a list of promise libraries that I really like. All of them implement the <a href="https://promisesaplus.com">Promises A+ spec</a>. For a more comprehensive list, check the conformant implementations list at <a href="https://promisesaplus.com/implementations">promisesaplus.com/implementations</a>.</p>

<ul>
<li><a href="https://github.com/cujojs/when">when.js</a></li>
<li><a href="https://github.com/kriskowal/q">Q</a></li>
<li><a href="https://docs.angularjs.org/api/ng/service/$q">$q</a> &mdash; the AngularJS implementation for Q</li>
</ul>

<p>Please make sure to leave some feedback, and submit a pull request if you find typos or errors in the logic, it was 3:00 AM when I wrote most of the content.</p>

<blockquote>
<p>Image credits: <a href="https://flic.kr/p/3f12JL">Promise?</a> by <a href="https://www.flickr.com/photos/13923263@N07/">Carmella Fernando</a></p>
</blockquote>


  <section>
    <h3>Share this article:</h3>
    <span class='st_facebook_large' displayText='Facebook'></span>
    <span class='st_twitter_large' displayText='Tweet'></span>
    <span class='st_linkedin_large' displayText='LinkedIn'></span>
    <span class='st_email_large' displayText='Email'></span>
    <span class='st_reddit_large' displayText='Reddit'></span>
    <span class='st_googleplus_large' displayText='Google +'></span>
    <span class='st_pinterest_large' displayText='Pinterest'></span>
  </section>
      <div id="disqus_thread"></div>
      <script type="text/javascript">
          /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
          var disqus_shortname = 'codesinz'; // required: replace example with your forum shortname

          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
      </script>
      <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </section>
</article>


  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-32468134-4', 'auto');
  ga('require', 'displayfeatures');
  ga('send', 'pageview');

</script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
<script>
  hljs.initHighlightingOnLoad();
</script>
<script type="text/javascript">var switchTo5x=true;</script>
<script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
<script type="text/javascript">stLight.options({publisher: "92204b4b-884e-4a7f-9337-a39d86c8b368", doNotHash: true, doNotCopy: false, hashAddressBar: true, shorten: false});</script>
</body>
</html>
