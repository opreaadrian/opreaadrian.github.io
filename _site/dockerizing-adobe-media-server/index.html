<!DOCTYPE html>
<html lang="en" itemscope itemtype="https://schema.org/Blog">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <title>Dockerizing Adobe Media Server</title>
  <meta name="keywords" content="workflow, productivity, fms, ams, docker, adobe, media, server, flash, commitments, blog">
  <meta name="author" itemprop="creator" content="Adrian Oprea">
  <meta name="description" itemprop="description" content="New job, new technologies, new problems to solve — that’s how it all started for me.
After switching jobs few months ago, I found myself working on an application that makes heavy use of
Adobe Media Server(AMS) for audio and video streaming.
Nothing too hard, or too complicated, except for the fact that all developers were using a single
install of AMS which was somewhere on a central server.
This started all my single-point-of-failure alarms, and started to ockerize the whole development
environment, including AMS. In this article, I will explain the steps I followed in order to
properly create a docker container running Adobe Media Server, with 
full RTMP/RTMPS support,

">
<meta property="og:type" content="article" />
<meta property="og:title" content="Dockerizing Adobe Media Server" />
<meta property="og:description" content="New job, new technologies, new problems to solve — that’s how it all started for me.
After switching jobs few months ago, I found myself working on an application that makes heavy use of
Adobe Media Server(AMS) for audio and video streaming.
Nothing too hard, or too complicated, except for the fact that all developers were using a single
install of AMS which was somewhere on a central server.
This started all my single-point-of-failure alarms, and started to ockerize the whole development
environment, including AMS. In this article, I will explain the steps I followed in order to
properly create a docker container running Adobe Media Server, with 
full RTMP/RTMPS support,

" />
<meta property="og:image" content="https://codesi.nz/images/posts/dockerizing-adobe-media-server/dock.jpg" />
<meta property="og:url" content="https://codesi.nz/dockerizing-adobe-media-server/" />
<meta property="og:locale" content="en_US" />
<meta property="article:published_time" content="2015-09-17T12:00:00+03:00" />
<meta property="article:modified_time" content="2015-09-17T12:00:00+03:00 " />
<link rel="canonical" href="https://codesi.nz/dockerizing-adobe-media-server/">

<!-- Twitter Card -->
<meta name="”twitter:creator”" value="">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:url" content="https://codesi.nz/dockerizing-adobe-media-server/">
<meta name="twitter:title" content="Dockerizing Adobe Media Server">
<meta name="twitter:description" content="New job, new technologies, new problems to solve — that’s how it all started for me.
After switching jobs few months ago, I found myself working on an application that makes heavy use of
Adobe Media Server(AMS) for audio and video streaming.
Nothing too hard, or too complicated, except for the fact that all developers were using a single
install of AMS which was somewhere on a central server.
This started all my single-point-of-failure alarms, and started to ockerize the whole development
environment, including AMS. In this article, I will explain the steps I followed in order to
properly create a docker container running Adobe Media Server, with 
full RTMP/RTMPS support,

">
<meta name="twitter:image" content="https://codesi.nz/images/posts/dockerizing-adobe-media-server/dock.jpg">

  

<link type="application/atom+xml" rel="alternate" href="/feed.xml" title="codesins. - The blog of Adrian Oprea, freelance web developer.">

  
    <link rel="author" href="https://plus.google.com/+AdrianOpreasWeb/">
    <link rel="publisher" href="https://plus.google.com/+AdrianOpreasWeb/">
  


  <!-- syntax highlighting CSS -->
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/normalize/4.0.0/normalize.min.css">
<link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,300italic,700,400italic,600,600italic,700italic,800,800italic' rel='stylesheet' type='text/css'>
<link href='https://fonts.googleapis.com/css?family=Lato:100,300,900' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="/stylesheets/screen.css">

  <script>
  var host = "codesi.nz";
  if ((host == window.location.host) && (window.location.protocol != "https:")) {
    window.location.protocol = "https";
  }
</script>


</head>
<body>

  <div class="header">
  <div role="branding" class="branding">
    <h1><a href="/" title="Go back to the homepage">codesins.</a></h1>
  </div>

  <div class="navigation">
    <nav role="navigation">
      <ul>
        <li 
          
              class="active" 
          
        ><a title="Navigate to the blog" href="/">Blog</a></li>
        <li ><a title="Find out more about me" href="/about/">Who am I</a></li>
        <li ><a title="Go to the contact page" href="/contact/">Let's chat</a></li>
      </ul>
    </nav>
  </div>
</div>

  <article class="article-full" itemprop="blogPosts" itemscope itemtype="https://schema.org/BlogPosting">
  <meta itemprop="datePublished" content="2015-09-17T12:00:00+03:00">
  <meta itemprop="dateModified" content="2015-09-17T12:00:00+03:00">
  <meta itemprop="keywords" content="workflow, productivity, fms, ams, docker, adobe, media, server, flash, commitments, blog">
  <meta itemprop="author" content="Adrian Oprea">
  
    <meta itemprop="inLanguage" content="en_US">
  

  <!-- DIVERSITY IS KEY -->
  <span itemprop="audience" itemscope itemtype="http://schema.org/PeopleAudience">
      <meta itemprop="gender" content="any">
  </span>
  <header class="article-header">
    <h1 class="article-header__heading article-header__heading--center article-header__heading--white" itemprop="headline">Dockerizing Adobe Media Server</h1>
    <div class="article-info article-info--delimited">
  <div class="article-info-inner">
    <a class="article-info__author-profile" href="/about" title="About the author: Adrian Oprea">
      <img class="article-info__author-image" src="/images/assets/adrian_oprea.png" alt="Author image: Adrian Oprea">
    </a>
    <p>
    Adrian Oprea on <time itemProp="datePublished" datetime="2015-09-17T12:00:00+03:00">17 Sep 2015</time><br>
     
    Published in 
    <span class="categories-list">
      
      <span class="categories-list-item">docker</span>
      
    </span>
    
    </p>
  </div>
</div>

  </header>

  <main class="article-body" itemprop="articleBody">
    <p>New job, new technologies, new problems to solve — that’s how it all started for me.<br />
After switching jobs few months ago, I found myself working on an application that makes heavy use of
Adobe Media Server(AMS) for audio and video streaming.<br />
Nothing too hard, or too complicated, except for the fact that all developers were using a single
install of AMS which was somewhere on a central server.<br />
This started all my single-point-of-failure alarms, and started to ockerize the whole development
environment, including AMS. In this article, I will explain the steps I followed in order to
properly create a <a href="https://www.docker.com/">docker</a> container running Adobe Media Server, with 
full RTMP/RTMPS support,</p>

<p>By now, many of the developers with an interest in DevOps should know about Docker, so I wont waste
time explaining what Docker is, there are plenty of resources out there, starting with the
<a href="https://docs.docker.com/">official docker documentation</a>, very rich in examples and explanations.</p>

<p>So, back to our AMS setup, there’s one “small” problem, setting it up inside a Docker container 
— it doesn’t work straight out of the box.<br />
This is because when you install Adobe Media Server, you get the application’s  license, <code class="highlighter-rouge">less</code>-ed 
to you, and you need to press the spacebar(or the down arrow if you feel a  bit crazy) and hit a 
key when you reach the bottom, confirming that you’ve read and agreed with the license.<br />
In my opinion, this is complicated stuff, so let’s simplify. As it turns out, just by going to the 
directory where the AMS archive is extracted, and removing “License.txt”, you can aviod having to 
“read” the whole license before continuing.<br />
So much for the first part of the problem. But there is still something to be done! The install
script is still waiting for user input, to continue with the setup, so what you have to do
next is to comment out the line that halts the  installation until it gets a keypress, in the 
<code class="highlighter-rouge">installAMS</code> script. For this matter in particular, you will need to use 
<a href="https://www.gnu.org/software/sed/manual/sed.html"><code class="highlighter-rouge">sed</code></a>, just like in the snippet below.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span><span class="nb">cd </span>ams_setup_directory
<span class="gp">$ </span>rm -Rf License.txt
<span class="gp">$ </span>sed -i -e <span class="s1">'s:read cont &lt; /dev/tty:#read cont &lt; /dev/tty:g'</span> installAMS</code></pre></figure>

<p>After getting rid of the license, and the blocking keypress timeout, comes the normal setup, where
you have to provide various answers to the installer. This is where the second problem appears, as 
you aren’t able to answer those questions yourself, because everything takes place when you’re 
building your Docker image.<br />
At one point, when I was at my lowest self-esteem level of all times, somebody suggested using 
<a href="http://expect.sourceforge.net/">Expect</a> to autofill the answers, but I wasn’t in the mood for
reading at that time. Besides, I knew that it had to be simpler than that, and I was right.</p>

<p>The answer lies in the setup itself. What you have to do is to do is to open your editor, and 
manually go through the setup, while writing down each answer you put in (including <code class="highlighter-rouge">RETURN</code>s).
At the end of the setup you will have something looking like the snippet below 
(whitespace is relevant):</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># begin input file</span>
      
n
/opt/adobe/ams 
admin
123456789
123456789
ams
y
ams
y
y

ams
1935,-443
1111
y
n
y
      
     
<span class="c"># end input file</span></code></pre></figure>

<p>that you can validate against AMS’s “Install Action Summary”, outlined below:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">----------- Install Action Summary -----------

Installation directory         <span class="o">=</span> /opt/adobe/ams

Adobe Media Server Port        <span class="o">=</span> 1935,-443
Adobe Media Admin Server Port  <span class="o">=</span> 1111
Interface <span class="o">(</span>IP address<span class="o">)</span> AMS will listen on  <span class="o">=</span> auto

Apache Install                 <span class="o">=</span> Yes


Administrative username        <span class="o">=</span> admin
Administrative password        <span class="o">=</span> <span class="o">(</span>suppressed<span class="o">)</span>

service owner                  <span class="o">=</span> ams

service user                   <span class="o">=</span> ams
service group                  <span class="o">=</span> ams

Run as daemon                  <span class="o">=</span> Yes</code></pre></figure>

<p>Now, to make this work, all you have to do is to save that input file, somewhere on the filesystem 
of your container, and simply <code class="highlighter-rouge">pipe</code> it through <code class="highlighter-rouge">installAMS</code>. I would recommend naming the file 
<code class="highlighter-rouge">installAMS.input</code>, so you can easily identify which is which. After you’ve created your input file, 
all you need to do is to execute one of the following commands, in the directory where the AMS 
archive was extracted: <code class="highlighter-rouge">./installAMS &lt; installAMS.input</code> or <code class="highlighter-rouge">cat installAMS.input | ./installAMS</code>.</p>

<p>Having this knowledge under our belts, it’s pretty straightforward to create a <code class="highlighter-rouge">Dockerfile</code> with 
the afore-mentioned setup, and with a bit more effort, to have a fully isolated Adobe Media Server
install, easily reproducible from version control.<br />
Your <code class="highlighter-rouge">Dockerfile</code> will probably look like the one below, with minor tweaks based on your needs:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">FROM centos:6
MAINTAINER Adrian Oprea&lt;adrian@codesi.nz&gt;

RUN rpm --import https://getfedora.org/static/0608B895.txt
RUN yum update -y <span class="o">&amp;&amp;</span> yum install -y tar python-setuptools
RUN easy_install supervisor

RUN mkdir -p /var/log/supervisor
COPY conf/supervisord.conf /etc/supervisord.conf

WORKDIR /tmp
RUN curl -O http://download.macromedia.com/pub/adobemediaserver/5_0_8/AdobeMediaServer5_x64.tar.gz
WORKDIR /tmp/ams_latest
RUN tar zxvf ../AdobeMediaServer5_x64.tar.gz -C . --strip-components<span class="o">=</span>1
RUN rm -Rf License.txt
RUN sed -i -e <span class="s1">'s:read cont &lt; /dev/tty:#read cont &lt; /dev/tty:g'</span> installAMS

COPY conf/installAMS.input installAMS.input

RUN ./installAMS &lt; installAMS.input
COPY certs /opt/adobe/certs
COPY conf/Adaptor.xml /opt/adobe/ams/conf/_defaultRoot_/Adaptor.xml

<span class="c"># CLEANUP</span>
WORKDIR /tmp
RUN rm -Rf ams_latest AdobeMediaServer5_x64.tar.gz

VOLUME <span class="o">[</span><span class="s2">"/opt/adobe/ams/applications"</span><span class="o">]</span>

EXPOSE 80 443 1111 1935

CMD <span class="o">[</span><span class="s2">"/usr/bin/supervisord"</span><span class="o">]</span></code></pre></figure>

<p>The whole setup, including a set of working self-signed SSL certificates so you can test the RTMPS 
connection, and a ready-made configuration for <code class="highlighter-rouge">docker-compose</code> is available on 
<a href="https://github.com/opreaadrian/docker-adobe-media-server">my GitHub account</a>.<br />
Make sure to get back via Twitter(<a href="https://twitter.com/opreaadrian">@opreaadrian</a>) with feedback, 
questions and suggestions, and also make use of the comments section.</p>

<blockquote>
  <p>Image credits: <a href="https://www.flickr.com/photos/bevgoodwin/">Beverley Goodwin</a></p>
</blockquote>

  </main>

  <footer class="article-footer">
    <section>
	<h3>Spread the word</h3>
	<span class='st_facebook_large' displayText='Facebook'></span>
	<span class='st_twitter_large' displayText='Tweet'></span>
	<span class='st_linkedin_large' displayText='LinkedIn'></span>
	<span class='st_email_large' displayText='Email'></span>
	<span class='st_reddit_large' displayText='Reddit'></span>
	<span class='st_googleplus_large' displayText='Google +'></span>
	<span class='st_pinterest_large' displayText='Pinterest'></span>
</section>
    <div class="pagination" role="navigation">
  
  <a href="/a-different-look-at-nodejs-application-architecture/" title="Previous article: Dockerizing Adobe Media Server" role="prev">&larr; A different look at Node.js application architecture</a>
  
  
  <a href="/unlearning-and-re-learning-stuff/" title="Next article: Dockerizing Adobe Media Server" role="next">Unlearning and re-learning stuff &rarr;</a>
  
</div>

    <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'codesinz'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  </footer>
</article>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-32468134-4', 'auto');
  ga('require', 'displayfeatures');
  ga('send', 'pageview');
</script>

  <!-- Drip -->
<script type="text/javascript">
  var _dcq = _dcq || [];
  var _dcs = _dcs || {}; 
  _dcs.account = '9282313';
  
  (function() {
    var dc = document.createElement('script');
    dc.type = 'text/javascript'; dc.async = true; 
    dc.src = '//tag.getdrip.com/9282313.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(dc, s);
  })();
</script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad();
  </script>
  <script type="text/javascript">var switchTo5x=true;</script>
  <script type="text/javascript" src="//ws.sharethis.com/button/buttons.js"></script>
  <script type="text/javascript">stLight.options({publisher: "92204b4b-884e-4a7f-9337-a39d86c8b368", doNotHash: true, doNotCopy: false, hashAddressBar: true, shorten: false});</script>
</body>
</html>

